# Configuration du Cluster Patroni
# ------------------------------
SCOPE=patroni-cluster
NAMESPACE=/service/

# Identifiants PostgreSQL (Extraits de patroni.yml)
# ------------------------------------------------
POSTGRES_USER=postgres
POSTGRES_PASSWORD=pg_password
REPLICATOR_USER=replicator
REPLICATOR_PASSWORD=rep_password

# Identifiants ETCD (Utilisés pour l'authentification)
# ----------------------------------------------------
ETCD_ROOT_PASSWORD=root_password
ETCD_PATRONI_USER=patroni
ETCD_PATRONI_PASSWORD=patroni_password

# Identifiants API Patroni (Authentification REST)
# ------------------------------------------------
PATRONI_API_USER=admin
PATRONI_API_PASSWORD=admin_password

# Identifiants HAProxy (Statistics & Admin)
# -----------------------------------------
ADMIN_HAPROXY_USER=ha_admin
ADMIN_HAPROXY_PASSWORD=ha_password

# Endpoints ETCD
# --------------
ETCD_HOSTS=etcd1:2379,etcd2:2379,etcd3:2379

# Chemins des Certificats (Internes aux conteneurs)
# -------------------------------------------------
CACERT_PATH=/etc/patroni/certs/ca.crt
ETCD_SERVER_CERT=/etc/patroni/certs/etcd-server.crt
ETCD_SERVER_KEY=/etc/patroni/certs/etcd-server.key
ETCD_CLIENT_CERT=/etc/patroni/certs/etcd-client.crt
ETCD_CLIENT_KEY=/etc/patroni/certs/etcd-client.key
PATRONI_API_CERT=/etc/patroni/certs/patroni-api.crt
PATRONI_API_KEY=/etc/patroni/certs/patroni-api.key
POSTGRES_SERVER_CERT=/etc/patroni/certs/postgresql-server.crt
POSTGRES_SERVER_KEY=/etc/patroni/certs/postgresql-server.key

# Ports Internes (Container side)
# -------------------------------
INT_SSH_PORT=22
INT_PG_PORT=5432
INT_PATRONI_PORT=8008
INT_ETCD_CLIENT_PORT=2379
INT_ETCD_PEER_PORT=2380
INT_HAPROXY_RW_PORT=5000
INT_HAPROXY_RO_PORT=5001
INT_HAPROXY_STATS_PORT=7000
INT_PGBOUNCER_PORT=6432

# Ports Externes (Host side)
# --------------------------
SSH_PORT_NODE1=22200
SSH_PORT_NODE2=22201
SSH_PORT_NODE3=22202
SSH_PORT_ETCD1=22203
SSH_PORT_ETCD2=22204
SSH_PORT_ETCD3=22205
SSH_PORT_HAPROXY=22206
SSH_PORT_PGBOUNCER=22207

HAPROXY_WEIGHT_NODE1=100
HAPROXY_WEIGHT_NODE2=50
HAPROXY_WEIGHT_NODE3=1

EXT_PG_PORT_NODE1=5432
EXT_PG_PORT_NODE2=5433
EXT_PG_PORT_NODE3=5434

EXT_PATRONI_PORT_NODE1=8008
EXT_PATRONI_PORT_NODE2=8009
EXT_PATRONI_PORT_NODE3=8010

EXT_ETCD_CLIENT_PORT_ETCD1=2379
EXT_ETCD_CLIENT_PORT_ETCD2=2381
EXT_ETCD_CLIENT_PORT_ETCD3=2382

EXT_HAPROXY_RW_PORT=5000
EXT_HAPROXY_RO_PORT=5001
EXT_HAPROXY_STATS_PORT=7000

EXT_PGBOUNCER_PORT=6432

# Paramètres de Sécurité Globaux
# ------------------------------
PATRONI_ETCD3_PROTOCOL=https
PATRONI_ETCD3_INSECURE=false
PYTHONHTTPSVERIFY=0

# PgBouncer SSL Modes
PGBOUNCER_CLIENT_SSLMODE=require
PGBOUNCER_SERVER_SSLMODE=require

# Option pour activer/désactiver le contrôle des certificats clients (mTLS)
# true = Strict (Certificat requis), false = Souple (TLS simple)
VERIFY_CLIENT_CERT=true

# Mapping pour patroni.yml/postgresql (plus granulaire)
PATRONI_VERIFY_CLIENT=optional
PG_HBA_SSL_TYPE=hostssl
PG_HBA_METHOD=scram-sha-256

# Paramètres de réplication
MAX_LAG_ON_FAILOVER=1048576

# Additional Subject Alternative Names (SANs) for certificates
# Format: DNS:host1,IP:192.168.1.10
# EXTRA_SANS=DNS:my-custom-host.local

# PostgreSQL Client SSL Settings (Hardening)
PGSSLMODE=require
PGSSLCERT=/etc/patroni/certs/postgresql-client.crt
PGSSLKEY=/etc/patroni/certs/postgresql-client.key
PGSSLROOTCERT=/etc/patroni/certs/ca.crt
